<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>POK</title>

<style>
    body {
        font-family: Arial, sans-serif;
        padding: 20px;
    }
    h2 {
        margin-bottom: 10px;
    }
    select {
        padding: 6px;
        margin-bottom: 15px;
    }
    table {
        border-collapse: collapse;
        width: 100%;
        font-size: 13px;
    }
    th, td {
        border: 1px solid #ccc;
        padding: 6px;
        text-align: left;
    }
    th {
        background: #f2f2f2;
    }
    .rm {
        background-color: #cfe2ff;
        font-weight: bold;
    }
    .pnbp {
        background-color: #ffe0b2;
        font-weight: bold;
    }
</style>
</head>

<body>

<h2>POK</h2>

<select id="filter">
    <option value="Semua">Semua</option>
    <option value="Umum">Umum</option>
    <option value="PKN">PKN</option>
    <option value="PN">PN</option>
    <option value="Penilaian">Penilaian</option>
    <option value="Lelang">Lelang</option>
    <option value="HI">HI</option>
    <option value="KI">KI</option>
</select>

<table id="tbl">
    <thead></thead>
    <tbody></tbody>
</table>

<script>
const CSV_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vSi8QhfAg_PpNxxZ8XYaSF3g5ZB2rYJ4IwG8Zq3vHEGWvOLgsc21aO5V-18qOudsfJ-kkAxF_SyRbok/pub?gid=589172339&single=true&output=csv";

let allData = [];

fetch(CSV_URL)
    .then(res => res.text())
    .then(csv => {
        allData = csv.split("\n").map(r =>
            r.split(",").map(c => c.replace(/^"|"$/g, "").trim())
        );
        renderTable();
    });

document.getElementById("filter").addEventListener("change", renderTable);

function renderTable() {
    const thead = document.querySelector("#tbl thead");
    const tbody = document.querySelector("#tbl tbody");
    thead.innerHTML = "";
    tbody.innerHTML = "";

    if (allData.length === 0) return;

    const header = allData[0];
    const rows = allData.slice(1);

    // tampilkan header
    const trh = document.createElement("tr");
    header.forEach(h => {
        const th = document.createElement("th");
        th.textContent = h;
        trh.appendChild(th);
    });
    thead.appendChild(trh);

    const filterVal = document.getElementById("filter").value;
    const usedKode = new Set();

    rows.forEach(r => {
        const kode = r[0];   // kolom KODE
        const sd   = r[1];   // kolom SD
        const kolI = r[8];   // kolom FILTER (I)

        if (!kode) return;

        // filter
        if (filterVal !== "Semua" && kolI !== filterVal) return;

        // hapus duplikat jika Semua
        if (filterVal === "Semua") {
            if (usedKode.has(kode)) return;
            usedKode.add(kode);
        }

        const tr = document.createElement("tr");

        if (kode.length > 27 && sd === "RM") tr.classList.add("rm");
        if (kode.length > 27 && sd === "PNBP") tr.classList.add("pnbp");

        r.forEach(c => {
            const td = document.createElement("td");
            td.textContent = c;
            tr.appendChild(td);
        });

        tbody.appendChild(tr);
    });
}
</script>

</body>
</html>
